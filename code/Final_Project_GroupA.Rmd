---
title: "Analysis of Global Greenhouse Gas Emissions"
output: html_document
runtime: shiny
---

<style>
h1.title {
  text-align: center;
  font-family: 'Georgia';
  margin-bottom: 1.5em;
  font-weight: bold;
  font-size: 25px;
  color: black;
}
</style>

<style>
h2.title {
  text-align: center;
  font-family: 'Georgia';
  font-weight: bold;
  font-size: 20px;
  margin-bottom: 1.5em;
  color: black;
}
</style>

<style>
h3.title {
  font-family: 'Georgia';
  font-weight: bold;
  font-size: 15px;
  margin-bottom: 1.5em;
  color: black;
}
</style>

<style>
  body {
    text-align: justify;
    font-family: "Georgia";
    font-size: 10pt;
    color: dimgray;
  }
</style>


## Xueer Luo, Qichen Xie, Jin Liu, Weiwen Dai{.title}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r, echo=FALSE}
# Run the application
library(readtext)
library(shiny)
library(maps)
library(ggplot2)
library(leaflet)
library(sp)
library(palmerpenguins)
library(tidyverse)
library(readr)
library(plotly)
library(shiny)
library(ggplot2)
library(dplyr)
library(tidyr)
library(tibble)
library(tm)
library(wordcloud)
library(SnowballC)
library(gutenbergr)
library(viridis)
```

```{r, echo=FALSE}
total_co2 <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_totals.csv") 
total_ghg <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_totals.csv") 
capita_co2 <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_capita_country.csv") 
capita_ghg <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_capita_country.csv") 
gdp_co2 <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_GDP_country.csv")
gdp_ghg <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_GDP_country.csv")
sector_co2 <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv")
sector_ghg <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_sector.csv")
```


From the start of the 21st century until 2019, there was a notable rise in global greenhouse gas (GHG) emissions, primarily due to the increase in CO2 emissions from emerging economies such as China. This led to a significant increase in atmospheric concentrations of GHGs, exacerbating the natural greenhouse effect and potentially threatening life on Earth. Despite a decline in emissions due to the COVID-19 pandemic in 2020, climate change remains a pressing issue.

To address this issue, countries are developing national emissions inventories and proposing and implementing actions to mitigate GHG emissions. However, CO2 emissions, the primary cause of global warming, continue to increase worldwide despite such efforts.

As a result, we want to find out the relationship between carbon emissions and global temperature trends over time and how have different countries contributed to this trend.<br><br>

## Map of Greenhouse Gas Emissions by Country (Total & Per Capita){.title}

In order to give everyone a clearer understanding of the greenhouse gas emissions of various countries in different years, we have drawn a map of greenhouse gas emissions. Get more intuitive feelings by choosing your own year, GHG type, and data type.<br><br>


```{r, echo=FALSE}
world_map <- map_data("world")
ui <- fluidPage(

  fluidRow(
    column(width = 4, 
           selectInput(
             inputId = "Year",
             label = "Select the year", 
             choices = c("1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018"))),
    
    column(width = 4,
           selectInput(
             inputId = "data_type",
             label = "Select the data", 
             choices =c("Total","Per Capita"))),
    
    column(width = 4,
           selectInput(
             inputId = "type",
             label = "Select the type of greenhouse gas", 
             choices =c("CO2","GHG"))),
  plotlyOutput("map")))

server <- function(input, output) {
   selectedPlot <- reactive({
    input$type
  })
   
  output$map <- renderPlotly({
    if (input$data_type == "Total"){
      if (input$type == "CO2"){
        emission <- total_co2
        input <- input$Year
        cols <- c("Country", input)
        emission <- emission[, cols]
        map_data <- left_join(world_map, emission, by = c("region" = "Country"))
        content <- paste("Country:",map_data$region,"\n",
                         "CO2_total:",map_data[, input],"\n")
        
        map <- ggplot(map_data, aes(x = long, y = lat, group = group, text = content)) +
          geom_polygon(aes(fill = map_data[, input])) +
          scale_fill_gradient(low = "lightgreen", high = "red", na.value = "lightgreen",name = input) +
          labs(title = "Total CO2 Emissions") +
          theme_void() +
          theme(plot.title = element_text(family = "Georgia"))
        
        ggplotly(map)}
      else{
        emission <- total_ghg
        input <- input$Year
        cols <- c("Country", input)
        emission <- emission[, cols]
        map_data <- left_join(world_map, emission, by = c("region" = "Country"))
        content <- paste("Country:",map_data$region,"\n",
                         "GHG_total:",map_data[, input],"\n")
      
        map <- ggplot(map_data, aes(x = long, y = lat, group = group, text = content)) +
          geom_polygon(aes(fill = map_data[, input])) +
          scale_fill_gradient(low = "lightgreen", high = "red", na.value = "lightgreen",name = input) +
          labs(title = "Other Greenhouse Gas Emissions in Total") +
          theme_void() +
          theme(text = element_text(family = "Georgia")) +
          geom_path(color = "white")
        ggplotly(map)}}
    else{
      if (input$type == "CO2"){
        emission <- capita_co2
        input <- input$Year
        cols <- c("Country", input)
        emission <- emission[, cols]
        map_data <- left_join(world_map, emission, by = c("region" = "Country"))
        content <- paste("Country:",map_data$region,"\n",
                         "CO2_capita:",map_data[, input],"\n")
        
        map <- ggplot(map_data, aes(x = long, y = lat, group = group, text = content)) +
          geom_polygon(aes(fill = map_data[, input])) +
          scale_fill_gradient(low = "lightgreen", high = "darkred", na.value = "lightgreen",name = input) +
          labs(title = "CO2 Emissions Per Capita") +
          theme(text = element_text(family = "Georgia")) +
          theme_void() +
          geom_path(color = "white")
        
        ggplotly(map)}
      else{
        emission <- capita_ghg
        input <- input$Year
        cols <- c("Country", input)
        emission <- emission[, cols]
        map_data <- left_join(world_map, emission, by = c("region" = "Country"))
        content <- paste("Country:",map_data$region,"\n",
                         "GHG_capita:",map_data[, input],"\n")
      
        map <- ggplot(map_data, aes(x = long, y = lat, group = group, text = content)) +
          geom_polygon(aes(fill = map_data[, input])) +
          scale_fill_gradient(low = "lightgreen", high = "darkred", na.value = "lightgreen",name = input) +
          theme(text = element_text(family = "Georgia")) +
          labs(title = "Other Greenhouse Gas Emissions Per Capita") +
          theme_void() +
          geom_path(color = "white")
        ggplotly(map)}
      
    }
  })
  
}
# Run the app
shinyApp(ui, server)
```


## Analysis of Annual Total Emissions by Country{.title}

In the first part of this research on global carbon dioxide and greenhouse gas emissions, we visualized the total emissions for each country using maps. Now, we will take a closer look at the top 10 emitting countries for each year, and examine how their emissions have changed from 1970 to 2018. By analyzing these trends, we can gain a deeper understanding of the dynamics of carbon dioxide and greenhouse gas emissions across the globe over the past few decades.

```{r, echo=FALSE}
data <- read.csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_totals.csv",header = TRUE, row.names = 1,check.names=FALSE)
data_2 <- read.csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_totals.csv", header = TRUE, row.names = 1, check.names = FALSE)
```

### Time Series Change of Greenhouse Gas Total Emissions By Country{.title}

```{r, echo=FALSE}
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      selectInput("country", "Select a country:", choices = row.names(data)),
      selectInput("gas", "Select a gas:", choices = c("CO2", "GHG"))),
    mainPanel(
               plotlyOutput("bar1")
             )
           )
)


server <- function(input, output) {
  
  # First plot
  output$bar1 <- renderPlotly({
    data_source <- reactive({
      if(input$gas == "CO2") {
        data
      } else {
        data_2
      }
    })
    
    # 根据选择的气体确定标签
    label <- reactive({
      if(input$gas == "CO2") {
        "CO2 Emissions"
      } else {
        "GHG Emissions"
      }
    })
    
    if(input$gas == "CO2"){
      data_selected <- data
      gas_label <- "CO2"
    } else {
      data_selected <- data_2
      gas_label <- "Greenhouse gases"
    }
    
    bar_data <- data_selected %>%
  filter(row.names(data_selected) == input$country) %>%
  select(-1) %>%
  gather(year, gas_emissions, -1) %>%
  mutate(year = as.numeric(year)) %>%
  arrange(year) %>%
  distinct(year, gas_emissions)

    
    p <- ggplot(bar_data, aes(x = year, y = gas_emissions, text = paste("Year: ", year, "<br>", gas_label, " Emissions: ", gas_emissions))) +
      geom_point(aes(color = gas_emissions), size = 4) +
      scale_color_gradient(low = "lightgreen", high = "darkgreen") +
      labs(x = "Year", y = gas_label) +
      ggtitle(paste0(input$country, "'s ", gas_label, " Emissions")) +
      theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
      theme(text = element_text(family = "Georgia")) +
      scale_x_continuous(breaks = seq(min(bar_data$year), max(bar_data$year), by = 5))

    
    ggplotly(p, tooltip = "text")
  })

}
shinyApp(ui, server)
```

By analyzing the gas emissions of CO2 and GHG of every country from 1972 to 2020, it is observed that the emission trends of the two gases are generally similar, but the peak levels of emissions vary across different countries. Countries such as the UK and Germany show a decreasing trend overall, while China, India, Iran, and South Korea demonstrate a rapid increase in emissions. On the other hand, the United States, Japan, and Russia exhibit an initial increase followed by a subsequent decrease in emissions.


### Ranking of Greenhouse Gas Total Emissions in Different Years (TOP10){.title}

```{r, echo=FALSE}
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
             selectInput(
               inputId = "year",
               label = "Select a year", 
               choices = c("1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018")),
    
             selectInput(
               inputId = "gas2", 
               label = "Select a gas:",
               choices = c("CO2", "GHG"))
             ),
      
     mainPanel(
               plotlyOutput("bar2")
             )
    )
)

server <- function(input, output) {
  selectedPlot <- reactive({
    input$type
  })
  output$bar2 <- renderPlotly({
    label2 <- reactive({
      if(input$gas2 == "CO2") {
        "CO2 Emissions"
      } else {
        "GHG Emissions"
      }
    })
    
    if(input$gas2 == "CO2"){
      data_selected2 <- data
      gas_label2 <- "CO2"
    } else {
      data_selected2 <- data_2
      gas_label2 <- "Greenhouse gases"
    }
    year_data <- data.frame(Country = data_selected2[,0], Value = data_selected2[,input$year])
    year_data <- arrange(year_data, desc(Value))
    year_data <- rownames_to_column(year_data, var = "Country")
    year_data <- year_data[1:10,]

    
    a <- ggplot(year_data, aes(x = reorder(Country, -Value), y = Value)) +
      geom_bar(stat = "identity", width = 0.5, fill = "darkgreen") +
      xlab("Country") +
      ylab("Emissions") +
      theme(text = element_text(family = "Georgia")) +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
      ggtitle(paste("Top 10 ", input$gas2, " Emitting Countries (Total)")) +
      theme(axis.text.x = element_text(angle = 45, hjust = 1))
    
    ggplotly(a)
    
    
    
  })
}
shinyApp(ui, server)

```

By analyzing the top ten countries in terms of CO2 and GHG gas emissions each year, it is found that between 1970 and 2005, China, the United States, and Russia consistently held the top three spots. Around 2005, China overtook the United States to become the top emitter of both CO2 and GHG, while India surpassed Iran to become the third-largest emitter of GHG. By 2011, India had also surpassed Iran to become the third-largest emitter of CO2.


## Analysis of Annual Per Capita Emissions by Country{.title}


### Ranking of Greenhouse Gas Emissions Per Capita in Different Years (TOP10){.title}

```{r, echo=FALSE}
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
           selectInput(
             inputId = "Year",
             label = "Select a year", 
             choices = c("1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018")),
  
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG"))),
    mainPanel(plotlyOutput("rank"
                         )
             )
  )
)

server <- function(input, output) {
   selectedPlot <- reactive({
    input$type
  })
   
  output$rank <- renderPlotly({
    selectedPlot <- reactive({
      input$type
  })
    if (input$type == "CO2"){
      rank_capita <- capita_co2
      input <- input$Year
      cols <- c("Country", input)
      rank_capita <- rank_capita[, cols]
      rank_capita <- rank_capita[order(desc(rank_capita[,input])),]
      rank_capita_top10 <- rank_capita[1:10,]
      colnames(rank_capita_top10) <- c("Country", "CO2_Per_Capita")
      
      rank_capita_top10$Country <- factor(rank_capita_top10$Country, levels = rank_capita_top10$Country)
      
      a <-ggplot(rank_capita_top10, aes(x = Country, y = CO2_Per_Capita)) +
        geom_bar(stat = "identity", width = 0.5, fill = "darkgreen") +
        xlab("Country") +
        ylab("Emissions") +
        ggtitle(paste("Top 10 CO2 Emitting Countries (Per Capita)")) +
        theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
              panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
        theme(panel.background = element_rect(fill = "white")) +
        theme(text = element_text(family = "Georgia")) +
        theme(axis.text.x = element_text(angle = 45, hjust = 1))
      
      ggplotly(a)
      } 
    else{
      rank_capita <- capita_ghg
      input <- input$Year
      cols <- c("Country", input)
      rank_capita <- rank_capita[, cols]
      rank_capita <- rank_capita[order(desc(rank_capita[,input])),]
      rank_capita_top10 <- rank_capita[1:10,]
      colnames(rank_capita_top10) <- c("Country", "GHG_Per_Capita")
      
      rank_capita_top10$Country <- factor(rank_capita_top10$Country, levels = rank_capita_top10$Country)
      
      a <-ggplot(rank_capita_top10, aes(x = Country, y = GHG_Per_Capita)) +
        geom_bar(stat = "identity", width = 0.5, fill = "darkgreen") +
        xlab("Country") +
        ylab("Emissions") +
        ggtitle(paste("Top 10 GHG Emitting Countries (Per Capita)")) +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
        theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
      
      ggplotly(a)
      } 

  })
  
}
# Run the app
shinyApp(ui, server)
```

In 1970, the top 5 countries with the highest emissions are Palau, Qatar, Curacao, United Arab Emirates and Luxembourg. Then in 2018, the top 5 countries with the highest emissions are Palau, Qatar, Kuwait, Trinidad and Tobago and Gibraltar. Palau and Qatar are always on the list.

Palau and Qatar have the highest carbon dioxide emissions per capita primarily due to their heavy dependence on fossil fuels for their energy needs. Both countries are small island nations that rely heavily on imported fossil fuels for their electricity and transportation.

In the case of Qatar, it is a major producer and exporter of natural gas, and also has significant oil reserves. The country's economy is heavily dependent on the oil and gas industry, and as a result, the consumption of fossil fuels is very high. Qatar also has a high standard of living, which means a greater consumption of energy per capita.

Palau, on the other hand, has limited access to renewable energy sources, and relies heavily on imported fossil fuels for its energy needs. The country has a small population but a significant tourist industry, which also contributes to its high carbon emissions per capita.

### Line Chart of Greenhouse Gas Emissions Per Capita from 1990 to 2018{.title}

```{r, echo=FALSE}
ui <- fluidPage(
  fluidRow(
    column(width = 3,
           selectInput(
             inputId = "Country1",
             label = "Select a country", 
             choices = capita_co2$Country)),
    column(width = 3,
           selectInput(
             inputId = "Country2",
             label = "Select a country", 
             choices = capita_co2$Country)),
    column(width = 3,
           selectInput(
             inputId = "Country3",
             label = "Select a country", 
             choices = capita_co2$Country)),
    column(width = 3,
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG")))
  ),
  plotlyOutput("lineplot"),
  
)

server <- function(input, output) {
   selectedPlot <- reactive({
    input$type
  })
   
  output$lineplot <- renderPlotly({
    if (input$type == "CO2"){
      Country1 = input$Country1
      Country2 = input$Country2
      Country3 = input$Country3
      
      country1 <- capita_co2[capita_co2$Country == Country1, ]
      country_first_row1 <- country1[1, ]
      country_first_row1 <- country_first_row1[, 22:50]
      
      country2 <- capita_co2[capita_co2$Country == Country2, ]
      country_first_row2 <- country2[1, ]
      country_first_row2 <- country_first_row2[, 22:50]
      
      country3 <- capita_co2[capita_co2$Country == Country3, ]
      country_first_row3 <- country3[1, ]
      country_first_row3 <- country_first_row3[, 22:50]
      
      df <- data.frame(
        x = c(1990:2018),
        y1 = t(country_first_row1[1, ]),
        y2 = t(country_first_row2[1, ]),
        y3 = t(country_first_row3[1, ])
        )
      colnames(df) <- c("year", "CO2_per_capita1", "CO2_per_capita2", "CO2_per_capita3")
      
      map2 <- ggplot(df, aes(x = year)) +
        geom_line(aes(y = CO2_per_capita1, color = Country1)) +
        geom_line(aes(y = CO2_per_capita2, color = Country2)) +
        geom_line(aes(y = CO2_per_capita3, color = Country3)) +
        scale_x_continuous(limits = c(1990, 2018), breaks = seq(1970, 2018, by = 2)) + 
        labs(title = "Line chart of CO2 emissions per capita in different countries over time from 1990 to 2018", x = "Year", y = "CO2 per capita") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
        theme(text = element_text(family = "Georgia")) +
        scale_color_manual(name = "Country", values = c("red","green", "blue"))
      ggplotly(map2)
      } 
    else{
      Country1 = input$Country1
      Country2 = input$Country2
      Country3 = input$Country3
      
      country1 <- capita_ghg[capita_ghg$Country == Country1, ]
      country_first_row1 <- country1[1, ]
      country_first_row1 <- country_first_row1[, 22:50]
      
      country2 <- capita_ghg[capita_ghg$Country == Country2, ]
      country_first_row2 <- country2[1, ]
      country_first_row2 <- country_first_row2[, 22:50]
      
      country3 <- capita_ghg[capita_ghg$Country == Country3, ]
      country_first_row3 <- country3[1, ]
      country_first_row3 <- country_first_row3[, 22:50]
      
      df <- data.frame(
        x = c(1990:2018),
        y1 = t(country_first_row1[1, ]),
        y2 = t(country_first_row2[1, ]),
        y3 = t(country_first_row3[1, ])
        )
      colnames(df) <- c("year", "GHG_per_capita1", "GHG_per_capita2", "GHG_per_capita3")
      
      map2 <- ggplot(df, aes(x = year)) +
        geom_line(aes(y = GHG_per_capita1, color = Country1)) +
        geom_line(aes(y = GHG_per_capita2, color = Country2)) +
        geom_line(aes(y = GHG_per_capita3, color = Country3)) +
        scale_x_continuous(limits = c(1990, 2018), breaks = seq(1990, 2018, by = 2)) + 
        labs(title = "Line chart of GHG emissions per capita in different countries over time from 1990 to 2018", x = "Year", y = "GHG per capita") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
        theme(text = element_text(family = "Georgia")) +
        scale_color_manual(name = "Country", values = c("red","green", "blue"))
      ggplotly(map2)
      }
  })
  
}
# Run the app
shinyApp(ui, server)
```

There is a different order for the top three countries in emissions per capita. The United States has the highest emissions per capita, China and India took second and third place respectively.

Multiple factors could contribute to the observed differences in CO2 and GHG emissions trends across different countries. Countries with rapidly growing economies tend to have higher levels of emissions due to increased industrial and commercial activity. For example, China and India have experienced significant economic growth in recent decades, increasing their emissions.

Secondly, the type of fuel used for energy generation varies across countries, which can affect their emissions levels. Countries that rely heavily on coal or other fossil fuels for energy production tend to have higher emissions. On the other hand, countries that have shifted towards cleaner energy sources such as natural gas, renewable energy, and nuclear power tend to have lower emissions. For instance, Germany and the UK have decreased their emissions by transitioning towards renewable energy sources.

Thirdly, countries with larger populations tend to have higher levels of emissions, as there is more demand for energy and resources. For example, China and India have the world’s largest populations, contributing to their higher emissions levels.

Moerover, government policies can also play a significant role in reducing emissions levels. Countries that have implemented policies to promote energy efficiency, reduce fossil fuel use, and incentivize the use of cleaner energy sources tend to have lower emissions levels. For instance, Japan and the US have implemented policies such as fuel efficiency standards and renewable energy subsidies to reduce their emissions.

Lastly, geographic and climate factors can also influence emissions levels. Countries with large land masses and significant agricultural activity tend to have higher emissions due to land-use changes and livestock farming. Additionally, countries with warmer climates tend to have higher energy demands for cooling and air conditioning. For example, Iran and South Korea have warm climates, which could contribute to their higher emissions levels.
Overall, a combination of economic, energy, demographic, policy, and environmental factors can help explain the differences in CO2 and GHG emissions trends across different countries.

## Analysis of Annual Per GDP Emissions by Country{.title}

### Line chart of Greenhouse Gas Emissions Per GDP from 1990 to 2018{.title}
```{r, echo=FALSE}
GHG <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_GDP_country.csv")
CO2 <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_GDP_country.csv") 
```

```{r, echo=FALSE}
ui <- fluidPage(
  fluidRow(
    column(width = 3,
           selectInput(
             inputId = "Country1",
             label = "Select a country", 
             choices = GHG$Country)),
    column(width = 3,
           selectInput(
             inputId = "Country2",
             label = "Select a country", 
             choices = GHG$Country)),
    column(width = 3,
           selectInput(
             inputId = "Country3",
             label = "Select a country", 
             choices = GHG$Country)),
    column(width = 3,
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG")))
  ),
  plotlyOutput("lineplot"),
  
)

server <- function(input, output) {
  selectedPlot <- reactive({
    input$type
  })
  

  output$lineplot <- renderPlotly({
    if (input$type == "CO2"){
      Country1 = input$Country1
      Country2 = input$Country2
      Country3 = input$Country3
      
      country1 <- CO2[CO2$Country == Country1, ]
      country_first_row1 <- country1[1, ]
      country_first_row1 <- country_first_row1[, 2:30]
      
      country2 <- CO2[CO2$Country == Country2, ]
      country_first_row2 <- country2[1, ]
      country_first_row2 <- country_first_row2[, 2:30]
      
      country3 <- CO2[CO2$Country == Country3, ]
      country_first_row3 <- country3[1, ]
      country_first_row3 <- country_first_row3[, 2:30]
      
      df <- data.frame(
        x = as.integer(1990:2018),
        y1 = as.numeric(t(country_first_row1[1, ])),
        y2 = as.numeric(t(country_first_row2[1, ])),
        y3 = as.numeric(t(country_first_row3[1, ]))
      )
      
      colnames(df) <- c("year", "CO2_per_GDP", "CO2_per_GDP2", "CO2_per_GDP3")
      
      map2 <- ggplot(df, aes(x = year)) +
        geom_path(aes( y = CO2_per_GDP, color = Country1)) +
        geom_path(aes( y = CO2_per_GDP2, color = Country2)) +
        geom_path(aes( y = CO2_per_GDP3, color = Country3))  +
        scale_x_continuous(limits = c(1990, 2020), breaks = seq(1990, 2020, by = 5)) + 
        labs(title = "Line chart of CO2 emissions per GDP in different countries over time from 1990 to 2020 (in 5-year stages)", x = "Year", y = "CO2 per GDP") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
        theme(text = element_text(family = "Georgia")) +
        scale_color_manual(name = "Country", values = c("red","green", "blue"))
      
      ggplotly(map2)
    } 
    else{
      Country1 = input$Country1
      Country2 = input$Country2
      Country3 = input$Country3
      
      country1 <- GHG[GHG$Country == Country1, ]
      country_first_row1 <- country1[1, ]
      country_first_row1 <- country_first_row1[, 2:ncol(country_first_row1)]
      
      country2 <- GHG[GHG$Country == Country2, ]
      country_first_row2 <- country2[1, ]
      country_first_row2 <- country_first_row2[, 2:ncol(country_first_row2)]
      
      country3 <- GHG[GHG$Country == Country3, ]
      country_first_row3 <- country3[1, ]
      country_first_row3 <- country_first_row3[, 2:ncol(country_first_row3)]
      
      df <- data.frame(
        x = as.integer(1990:2018),
        y1 = as.numeric(t(country_first_row1[1, ])),
        y2 = as.numeric(t(country_first_row2[1, ])),
        y3 = as.numeric(t(country_first_row3[1, ]))
      )
      
      colnames(df) <- c("year", "GHG_per_GDP", "GHG_per_GDP2", "GHG_per_GDP3")
      
      map2 <- ggplot(df, aes(x = year)) +
  geom_line(aes(y = GHG_per_GDP, color = Country1))  +
  geom_line(aes(y = GHG_per_GDP2, color = Country2))+
  geom_line(aes(y = GHG_per_GDP3, color = Country3))  +
  scale_x_continuous(limits = c(1990, 2020), breaks = seq(1990, 2020, by = 5)) + 
  labs(title = "Line chart of GHG emissions per GDP in different countries over time from 1990 to 2020 (in 5-year stages)", 
       x = "Year", y = "GHG per GDP") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
        theme(text = element_text(family = "Georgia")) +
  scale_color_manual(name = "Country", values = c("red","green", "blue"))

ggplotly(map2)

    }
  })
  
}
    # Run the app
shinyApp(ui, server)
```

### Ranking of Greenhouse Gas Emissions Per GDP in Different Years (TOP10){.title}

```{r, echo=FALSE, warning=FALSE}
GHG <- GHG %>%
  mutate_at(vars(-Country), as.numeric)

CO2 <- CO2 %>%
  mutate_at(vars(-Country), as.numeric)

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
           selectInput(
             inputId = "Year",
             label = "Select a Year", 
             choices = c(1990:2018)),
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG"))),
    mainPanel(plotlyOutput("lineplot"))))

server <- function(input, output) {
  output$lineplot <- renderPlotly({
    if (input$type == "CO2") {
      co2_year <- CO2[, input$Year]
      co2_by_country <- data.frame(Country = CO2[, 1], CO2 = co2_year)
      colnames(co2_by_country) <- c("Country", "CO2")
      sorted_co2_by_country <- co2_by_country %>%
        arrange(desc(CO2))
      top_ten_co2_emitting_countries <- head(sorted_co2_by_country, 10)
      
      # Create bar chart with plotly
      plot <- top_ten_co2_emitting_countries %>%
        plot_ly(x = ~CO2, y = ~reorder(Country, CO2), type = "bar", orientation = "h", marker = list(color = "rgba(50, 171, 96, 0.6)", line = list(color = "rgba(50, 171, 96, 1.0)", width = 2)), text = ~paste("Country: ", Country, "<br>CO2: ", CO2), hoverinfo = "text", showlegend = FALSE) %>%
        layout(title = "Top10 CO2 Emitting Countries (Per GDP)",
               xaxis = list(title = "CO2 Emissions (metric tons)"),
               yaxis = list(title = "Country", autorange = "reversed", tickfont = list(size = 15), automargin = TRUE),
               margin = list(l = 100, r = 20, t = 100, b = 100),
               plot_bgcolor = "white", paper_bgcolor = "white",
               font = list(family = "Georgia", size = 15),
               hoverlabel = list(bgcolor = "white", font = list(family = "Georgia", size = 15))) %>%
        
      
      # Return the plot
      return(plot)
    }
    else{
      GHG_year <- GHG[, input$Year]
      GHG_by_country <- data.frame(Country = GHG[, 1], GHG = GHG_year)
      colnames(GHG_by_country) <- c("Country", "GHG")
      sorted_GHG_by_country <- GHG_by_country %>%
        arrange(desc(GHG))
      top_ten_GHG_emitting_countries <- head(sorted_GHG_by_country, 10)
      
      # Create bar chart with plotly
      plot <- top_ten_GHG_emitting_countries %>%
        plot_ly(x = ~GHG, y = ~reorder(Country, GHG), type = "bar", orientation = "h", marker = list(color = "rgba(50, 171, 96, 0.6)", line = list(color = "rgba(50, 171, 96, 1.0)", width = 2)), text = ~paste("Country: ", Country, "<br>GHG: ", GHG), hoverinfo = "text", showlegend = FALSE) %>%
        layout(title = "Top10 GHG Emitting Countries (Per GDP)",
               xaxis = list(title = "GHG Emissions (metric tons)"),
               yaxis = list(title = "Country", autorange = "reversed", tickfont = list(size = 15), automargin = TRUE),
               margin = list(l = 100, r = 20, t = 100, b = 100),
               plot_bgcolor = "white", paper_bgcolor = "white",
               font = list(family = "Georgia", size = 15),
               hoverlabel = list(bgcolor = "white", font = list(family = "Georgia", size = 15)))
      
      # Return the plot
      return(plot)
    }
  })
}

# Run the app
shinyApp(ui, server)
```

In conclusion, the trend of CO2/GHG emission per GDP can be summariesed into following causes:

Technological advancements: Over time, technological advancements can lead to a reduction in CO2/GHG emissions per unit of GDP. For example, as more efficient and cleaner technologies are developed, businesses may be able to produce goods and services with less carbon emissions. This can be seen in some countries where the CO2/GHG emissions per GDP have decreased over time.

Environmental policies: Environmental policies implemented by governments can influence the trend in CO2/GHG emissions per GDP over time. Policies such as carbon pricing, renewable energy incentives, and regulations can lead to a decrease in CO2/GHG emissions per GDP. Conversely, policies that prioritize economic growth over environmental concerns may result in an increase in CO2/GHG emissions per GDP. Take US as an example: Energy-related carbon dioxide (CO2) emissions in 2012 were the lowest in the United States since 1994. The largest drop in emissions in 2012 came from coal, which is used almost exclusively for electricity generation. During 2012, particularly in the spring and early summer, low natural gas prices led to competition between natural gas- and coal-fired electric power generators. Lower natural gas prices resulted in reduced levels of coal generation, and increased natural gas generation—a less carbon-intensive fuel for power generation, which shifted power generation from the most carbon-intensive fossil fuel (coal) to the least carbon-intensive fossil fuel (natural gas).

Different stages of development: Different countries may be at different stages of development, and this can influence the trend in CO2/GHG emissions per GDP over time. Countries that are still rapidly developing their economies may see an increase in CO2/GHG emissions per GDP as they prioritize economic growth. However, as these countries continue to develop, they may eventually reach a stage where they prioritize sustainability over growth, resulting in a decrease in CO2/GHG emissions per GDP.


## Analysis of Annual Emissions by Sector{.title}

```{r, echo=FALSE}
CO2_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv",show_col_types = FALSE)
GHG_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_sector.csv",show_col_types = FALSE) 
```

```{r, echo=FALSE}
CO2_sector <- pivot_longer(CO2_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
CO2_sector <- CO2_sector %>% 
  select(Sector, Country, year, value)
CO2_sum <- CO2_sector %>%    
  group_by(Sector,year) %>%
  summarise(value = sum(value))
CO2_sum$year <- as.numeric(as.character(CO2_sum$year))

GHG_sector <- pivot_longer(GHG_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
GHG_sum <- GHG_sector %>%
  group_by(Sector,year) %>%
  summarise(value = sum(value))
GHG_sum$year <- as.numeric(as.character(GHG_sum$year))
```

### Time Series Change of Greeenhouse Gas Emissions By Sector{.title}


```{r, echo=FALSE}
ui <- fluidPage(
  fluidRow(
    column(width = 6,
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG")))),
  plotlyOutput("lineplot"))

server <- function(input, output) {
  CO2_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv",show_col_types = FALSE)
  GHG_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_sector.csv",show_col_types = FALSE) 
  
  CO2_sector <- pivot_longer(CO2_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
  CO2_sector <- CO2_sector %>% 
    select(Sector, Country, year, value)
  CO2_sum <- CO2_sector %>%
    group_by(Sector,year) %>%
    summarise(value = sum(value))
  CO2_sum$year <- as.numeric(as.character(CO2_sum$year))
  
  GHG_sector <- pivot_longer(GHG_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
  GHG_sum <- GHG_sector %>%
    group_by(Sector,year) %>%
    summarise(value = sum(value))
  GHG_sum$year <- as.numeric(as.character(GHG_sum$year))
  
  selectedPlot <- reactive({
    input$type
  })
  
  output$lineplot <- renderPlotly({
    if (input$type == "CO2"){
      input <- input$Country
      sec1 <- ggplot(data = CO2_sum, 
                     aes(x = year, y = value, color=Sector)) + 
        geom_line() +
        scale_x_continuous(limits = c(1970,2018),breaks = seq(1970, 2018, 10)) +
        scale_color_viridis(discrete = TRUE) +
        labs(title="CO2 Emission by Sector", 
             x="Year of Emission",
             y="CO2 Emission Amount",
             caption="Source: Public database") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
        theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
      
      ggplotly(sec1)}
    else{
      sec2 <- ggplot(data = GHG_sum, 
                     aes(x = year, y = value, color=Sector)) + 
        geom_line() +
        scale_x_continuous(limits = c(1970,2018),breaks = seq(1970, 2018, 10)) +
        scale_color_viridis(discrete = TRUE) +
        labs(title="GHG Emission by Sector", 
             x="Year of Emission",
             y="GHG Emission Amount",
             caption="Source: Public database")+
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
        theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
        
      ggplotly(sec2)}
  })
  
}

shinyApp(ui, server)
```

There are five primary sources of greenhouse gas emission by the economic sector. The Power Industry generates the largest share of emissions which mainly come from electricity production used by other industry sectors. The Industrial Combustion sector generates the second largest share by burning fossil fuels, mostly coal and natural gas. The Transportation sector also steadily occupies the forefront of total emissions by burning fossil fuel for vehicles. Besides, sectors of Building and Other Sectors’ long-term emissions are stable and relatively low.

From 1970 to 2020, emissions from the Power Industry grew rapidly, ranking first among all sectors. And the second fastest-growing sector was Transportation, which even ranks second in total emissions in recent years.

The total carbon emissions of each sector showed an overall upward trend, consistent with the process of global economic development.

### Time Series Change of Greeenhouse Gas Emissions By Country and Sector{.title}

```{r, echo=FALSE}
filter_data <- function(country, dataset) {
  # get the dataset
  data <- switch(dataset,
                 "CO2" = CO2_sector,
                 "GHG" = GHG_sector)
  # filter data for the given country
  data_country <- data %>% filter(Country == country)
  data_country$year <- as.numeric(as.character(data_country$year))
  
  # return the filtered and formatted data
  return(data_country)
}

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
             # Dropdown menu to select country
             selectInput("country",
                         "Select a country:",
                         choices = unique(CO2$Country)),
             # Radio buttons to select dataset
             radioButtons("dataset",
                          "Select a gas:",
                          choices = c("CO2", "GHG"),
                          selected = "CO2")),
     mainPanel( 
          plotlyOutput("lineplot")))
)

server <- function(input, output) {
  CO2_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv",show_col_types = FALSE)
  GHG_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_sector.csv",show_col_types = FALSE) 

  CO2_sector <- pivot_longer(CO2_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
  CO2_sector <- CO2_sector %>% 
    select(Sector, Country, year, value)
  CO2_sum <- CO2_sector %>%
    group_by(Sector,year) %>%
    summarise(value = sum(value))
  CO2_sum$year <- as.numeric(as.character(CO2_sum$year))
  
  GHG_sector <- pivot_longer(GHG_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
  GHG_sum <- GHG_sector %>%
    group_by(Sector,year) %>%
    summarise(value = sum(value))
  GHG_sum$year <- as.numeric(as.character(GHG_sum$year))
 filtered_data <- reactive({
    req(input$dataset, input$country)
    if (length(input$dataset) != 1) {
      stop("Input dataset must be a single value.")
    }
    if (input$dataset == "CO2") {
      filter_data(input$country, "CO2")
    } else {
      filter_data(input$country, "GHG")
    }
  })
  
  # render the plot using the filtered data
  output$lineplot <- renderPlotly({
    ggplot(filtered_data(), 
           aes(x = year, y = value, color = Sector)) + 
      geom_line() +
      scale_x_continuous(limits = c(1970, 2018), breaks = seq(1970, 2018, 10)) +
      scale_color_viridis(discrete = TRUE) +
      labs(title = "Emission by Sector", 
           x = "Year",
           y = ifelse(input$dataset == "CO2", "CO2 Emission Amount", "GHG Emission Amount"),
           caption = "Source: Public database") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
      theme(panel.background = element_rect(fill = "white")) +
      theme(text = element_text(family = "Georgia"))
  })
  
}

shinyApp(ui, server)
```

The total trend of global emissions by sectors is in line with the emission structure of countries with the highest emissions.

As the top four countries in total emissions, China, the United States, India, and Russia all have very high emissions in Power Industry Sector, accounting for the first proportion in their internal emission structure.

However, for the second largest part of the emission structure, these countries have different characteristics. Industrial Combustion in China and India is their second largest emitter, while for US the Transportation is the second largest sector.

The different emission structures among countries are due to different economic structures. China’s economic growth has primarily been powered by coal, and India’s soaring population and fast-growing economy have also seen emissions there rising dramatically. Due to the globalization of the industrial chain, United States emissions in Industrial-related parts have declined and the Transportation will be among the top emitters for a long time.

### Countries' Proportion Greenhouse Gas Emissions By Sector{.title}

```{r, warning=FALSE, message=FALSE, echo=FALSE}
# Data loading and prepossessing
CO2_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv",show_col_types = FALSE)
GHG_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/GHG_sector.csv",show_col_types = FALSE) 

CO2_sector <- pivot_longer(CO2_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
CO2_sector <- CO2_sector %>% 
  select(Sector, Country, year, value)
CO2_sum <- CO2_sector %>%
  group_by(Sector,year,Country) %>%
  summarise(sum_value = sum(value))
CO2_sum$year <- as.numeric(as.character(CO2_sum$year))

GHG_sector <- pivot_longer(GHG_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
GHG_sum <- GHG_sector %>%
  group_by(Sector,year,Country) %>%
  summarise(sum_value = sum(value))
GHG_sum$year <- as.numeric(as.character(GHG_sum$year))

top10_countries_CO2 <- CO2_sector %>%
  group_by(Country) %>%
  summarise(total_value = sum(value)) %>%
  arrange(desc(total_value)) %>%
  top_n(10, total_value)
country10_CO2 <- subset(top10_countries_CO2, select = Country)

top10_countries_GHG <- GHG_sector %>%
  group_by(Country) %>%
  summarise(total_value = sum(value)) %>%
  arrange(desc(total_value)) %>%
  top_n(10, total_value)
country10_GHG <- subset(top10_countries_GHG, select = Country)

# Create a new dataframe with the selected top 10 countries
data_CO2 <- CO2_sum[CO2_sum$year %in% c("1985","2000","2015") 
                & CO2_sum$Country %in% country10_CO2$Country, ]
data_CO2$Sector <- ifelse(data_CO2$Sector == "Other industrial combustion", "Combustion", data_CO2$Sector)

data_GHG <- GHG_sum[GHG_sum$year %in% c("1985","2000","2015") 
                & GHG_sum$Country %in% country10_GHG$Country, ]
data_GHG$Sector <- ifelse(data_GHG$Sector == "Other industrial combustion", "Combustion", data_GHG$Sector)
```

```{r, echo=FALSE}
ui <- fluidPage(
  fluidRow(
    column(width = 6,
           selectInput(
             inputId = "type",
             label = "Select a gas", 
             choices =c("CO2","GHG")))),
    plotlyOutput("barplot"))

server <- function(input, output) {
   selectedPlot <- reactive({
    input$type
  })
   
   output$barplot <- renderPlotly({
      if (input$type == "CO2"){
        sec3 <- ggplot(data = data_CO2, 
            aes(year,sum_value)) + 
            geom_bar(aes(fill = Country), position = "fill", stat = "identity") +
            ylab("Emission Proportion") + 
            labs(title = "Counrties' CO2 Emission Proportion by Sectors",
            y = "Emission Proportion", x = "", caption="Source: Public database") + 
            facet_grid(~Sector) +
            theme(axis.text.x = element_text(angle=50, hjust=1)) +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
          theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
        
        ggplotly(sec3)}
     else{
       sec4 <- ggplot(data = data_GHG, 
          aes(year,sum_value)) + 
            geom_bar(aes(fill = Country), position = "fill", stat = "identity") +
            ylab("Emission Proportion") + 
            labs(title = "Counrties' GHG Emission Proportion by Sectors",
            y = "Emission Proportion", x = "", caption="Source: Public database") + 
            facet_grid(~Sector) +
            theme(axis.text.x = element_text(angle=50, hjust=1)) +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
         theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
       
 ggplotly(sec4)}
   })
}
shinyApp(ui, server)
```

In the Buildings sector, China’s share has increased over time, which is related to the Chinese government’s macro policy of stimulating the Chinese economy through real estate.

In the Combustion, Power industry, and Other sectors, China is still the biggest emitter resulting from its reliance on coal for industrial production.

In the Transportation sector, the United States is the biggest contributor to emissions which is related to the high number of vehicles per person and the frequency of vehicle use there. However, United States’s share in this sector is decreasing continuously.
    
### Countries' CO2 Emission Structure by Sectors{.title}

```{r, echo=FALSE,fig.align='center'}
CO2_sector <- read_csv("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/CO2_sector.csv",show_col_types = FALSE)
CO2_sector <- pivot_longer(CO2_sector, cols = `1970`:`2018`, names_to = "year", values_to = "value")
CO2_sector <- CO2_sector %>% 
  select(Sector, Country, year, value)

top_10_categories <- CO2_sector %>%
  group_by(Country) %>%
  summarise(total_value = sum(value)) %>%
  arrange(desc(total_value)) %>%
  top_n(10, total_value)
country10 <- subset(top_10_categories, select = Country)

CO2_mean <- CO2_sector %>%
  group_by(Sector,Country) %>%
  summarise(mean_value = mean(value),
            sum_value = sum(value))

CO2_mean <- CO2_mean[CO2_mean$Country %in% country10$Country, ]
ggplot(CO2_mean, aes(x = Country, y = sum_value, fill = Sector)) +
    geom_col() +
    coord_polar() +
    scale_color_viridis(discrete = TRUE) +
    labs(y = "Emission Value", x = "Country") +
      theme(panel.grid.major = element_line(color = "gray94",linewidth = 1, linetype = "dashed"),
        panel.grid.minor = element_line(color = "gray94",linewidth = 1, linetype = "dotted")) +
  theme(text = element_text(family = "Georgia")) +
      theme(panel.background = element_rect(fill = "white"))
```

We calculated the total emissions of each country since 1970, and the results are shown in the circular bar chart. United States, China, and Russia are the top three carbon emitters in history, and their structures are different.

The Power Industry constitutes the largest carbon emission part in the United States and Russia, while most of China’s carbon emissions in history have come from Combustion."), the difference in emissions between the top three carbon emitters and the rest of the top 10 countries is huge.

In conclusion, from the time change analysis and horizontal structure comparison among countries, we can know that emissions come from many sectors so we need different solutions to decarbonize the economy.

The energy consumed by industrial production accounts for the highest proportion among all carbon emission sectors. Carbon emissions from combustion in developing countries account for the second largest share of their emission structure, while in developed countries the second largest component of emissions is the Transportation sector.

## Word Cloud of Emission Reduction Methods{.title}

```{r, echo=FALSE, fig.height=50, fig.width= 50}
library(readtext)

ui <- fluidPage(
  plotOutput("wordcloudPlot")
    )

server <- function(input, output) {
  # 生成词云图
  output$wordcloudPlot <- renderPlot({
    measure <- readtext("https://raw.githubusercontent.com/QMSS-G5063-2023/Group_A_Carbon-Emission/main/data/measures.docx")
    # replace url
    measure$text <- gsub("&amp", " ", measure$text)
    # replace email
    measure$text <- gsub("(RT|via)((?:\\b\\W*@\\w+)+)", " ", measure$text)
    measure$text <- gsub("@\\w+", " ", measure$text)
    # replace punctuation
    measure$text <- gsub("[[:punct:]]", " ", measure$text)
    # replace digits
    measure$text <- gsub("[[:digit:]]", " ", measure$text)
    # replace website address
    measure$text <- gsub("http\\w+", " ", measure$text)
    # replace two or more tabs
    #measure$text <- gsub("[ \t]{2,}", " ", measure$text)
    # replace start/end with more than one whitespaces
    measure$text <- gsub("^\\s+|\\s+$", " ", measure$text) 
    measure$text <- gsub("\\b(and|the|for|that|the|with|doi|has|all)\\b", "", measure$text)

    #temporarily suppress warning for this chunk 
    defaultW <- getOption("warn") 

    options(warn = -1) 

    # word cloud for Pride
    wordcloud(measure, max.words = 100, min.freq=2,random.order = FALSE, rot.per=0, colors=c('darkgreen','darkseagreen','darkolivegreen3','gold4','coral'),font.family = "Georgia")
  })
}

# 运行Shiny App
shinyApp(ui = ui, server = server)

```

Since the United States exhibits an initial increase followed by a subsequent decrease in emissions, we decide to explore how the USA plans to achieve decarbonization, we collect the text from the book Accelerating Decarbonization of the U.S. Energy System, Chapter 4. By analyzing the word cloud, we concluded these three topics that represent its decarbonization measures:

Infrastructure: The US government would heavily invest in infrastructure construction to reduce greenhouse gas emissions, such as promoting the use of clean transportation vehicles, and improving public transportation. In addition, the government can strengthen regulation in the power industry, adopt stricter emission standards, and impose penalties to encourage power plants to reduce pollution.

Investment: The US government would encourage and guide financial institutions and companies to increase their investments in renewable energy and clean technology. This can be achieved by reducing taxes, offering preferential policies, and implementing other economic stimulus measures to increase capital inflows into these areas. Additionally, the government can support research and development of new low-carbon technologies, and promote the commercialization of these technologies by reducing research and development costs.

Transition: The US government can promote economic transition and facilitate the shift towards a low-carbon economy. This includes promoting energy transition through policy and regulatory changes, such as reducing dependence on fossil fuels, promoting the development and use of renewable energy, and promoting technological innovation in clean energy.


## Conclusion{.title}

(1) The data on fossil CO2 and greenhouse gas emissions reveal that multiple factors contribute to the observed differences in emissions trends across countries. Economic growth, fuel types, population size, government policies, and climate and geographic factors all play a role. 

(2) Palau and Qatar consistently have high per capita emissions due to their small populations, high economic development, and hot and humid climates. 

(3) The Power Industry generates the largest share of emissions globally, followed by the Industrial Combustion and Transportation sectors. Emissions from the Power Industry and Transportation sectors have grown rapidly since 1970, consistent with global economic development. 

(4) The emission structures of the top emitting countries, such as China, India, the United States, and Russia, differ due to their economic structures and fuel sources. The top three carbon emitters in history are the United States, China, and Russia, with the Power Industry being the largest carbon emission part in the United States and Russia, and Combustion being the main contributor to China's carbon emissions.